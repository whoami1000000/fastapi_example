import requests

SERVER_API = 'http://127.0.0.1:8001'
JSON_EXAMPLE = {'alpha_p': 1.0,
                'alpha_ff': 1.08286,
                'beta_p': -0.334411,
                'beta_ff': -1.36535,
                'r_mag': 1.7184641361236572,
                'z_mag': -0.026382626965641975,
                'center': 1.7184641361236572,
                'ip': 5.5,
                'b_tor': 968988.9375,
                'steps_num': 20,
                'steps': [{'step': 0,
                           'currents': [-31364.0, -30565.39844, -138447.6709,
                                        -27541.59772, -189362.24023,
                                        124713.19727, 103863.30884,
                                        -138174.91821, -161749.85718, 1408.03129,
                                        39758.30292, -179581.60791, -48394.26331,
                                        -49269.24414, 5531.44069, 145253.35352,
                                        -105902.08374, -318198.63281,
                                        140728.87207, 66785.59631]},
                          {'step': 5,
                           'currents': [
                               -31365.0, -30565.39844, -138447.6709, -27541.59772, -189362.24023, 124713.19727,
                               103863.30884, -138174.91821,
                               -161749.85718,
                               1408.03129,
                               39758.30292,
                               -179581.60791,
                               -48394.26331,
                               -49269.24414,
                               5531.44069,
                               145253.35352,
                               -105902.08374,
                               -318198.63281,
                               140728.87207,
                               66785.59631]},
                          {'step': 14,
                           'currents': [-31366.0, -30565.39844, -138447.6709,
                                        -27541.59772, -189362.24023,
                                        124713.19727, 103863.30884,
                                        -138174.91821, -161749.85718, 1408.03129,
                                        39758.30292, -179581.60791, -48394.26331,
                                        -49269.24414, 5531.44069, 145253.35352,
                                        -105902.08374, -318198.63281,
                                        140728.87207, 66785.59631]}]}

SIM_NUM = 10


def main():
    data = []
    for i in range(SIM_NUM):
        rsp = requests.post(url=f'{SERVER_API}/simulate', json=JSON_EXAMPLE)
        j = rsp.json()
        print(j)
        data.append([j['id'], j['status']])

    counter = 0

    while counter != len(data):
        for i in range(len(data)):
            sim_id, status = data[i]
            if status not in ['done', 'failed']:
                rsp = requests.get(url=f'{SERVER_API}/status', params={'id': sim_id})
                j = rsp.json()
                print(j)
                data[i][1] = j['status']
                if j['status'] == 'done':
                    counter += 1


if __name__ == '__main__':
    main()
